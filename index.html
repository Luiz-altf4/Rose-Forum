<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Roxe - Comunidade estilo Reddit">
    <meta name="keywords" content="f√≥rum, comunidade, discuss√£o, posts, reddit">
    <title>r/Roxe - A Melhor Comunidade</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ö´</text></svg>">
</head>
<body>
    <!-- Reddit-Style Header -->
    <header class="reddit-header">
        <div class="reddit-nav">
            <div class="nav-left">
                <div class="hamburger-menu" onclick="toggleSidebar()">‚ò∞</div>
                <div class="logo-container">
                    <span class="logo">‚ö´</span>
                    <span class="logo-text">Roxe</span>
                </div>
            </div>
            
            <div class="nav-center">
                <div class="search-bar">
                    <input type="text" placeholder="Search r/Roxe" id="redditSearch">
                    <button onclick="searchPosts()">üîç</button>
                </div>
            </div>
            
            <div class="nav-right">
                <div class="user-menu">
                    <div class="user-menu-trigger" onclick="toggleUserMenu()">
                        <div class="user-avatar-small" id="userAvatarSmall">U</div>
                        <span id="userKarma">0 karma</span>
                        <span>‚ñº</span>
                    </div>
                    <div class="user-menu-dropdown" id="userMenuDropdown">
                        <button class="user-menu-item" onclick="openProfile()">üë§ Meu Perfil</button>
                        <button class="user-menu-item" onclick="openChatModal()">üí¨ Bate-Papo</button>
                        <button class="user-menu-item" onclick="openFriendsModal()">üë• Amigos</button>
                        <button class="user-menu-item" onclick="openSettings()">‚öôÔ∏è Configura√ß√µes</button>
                        <button class="user-menu-item" onclick="toggleTheme()">üåô Tema</button>
                        <button class="user-menu-item" onclick="logout()">üö™ Sair</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content - Reddit Layout -->
    <div class="reddit-layout">
        <!-- Sidebar -->
        <aside class="reddit-sidebar" id="sidebar">
            <!-- Profile Card -->
            <div class="profile-sidebar">
                <div class="profile-header">
                    <div class="profile-avatar" id="profileAvatar">U</div>
                    <div class="profile-name" id="profileName">Carregando...</div>
                    <div class="profile-username" id="profileUsername">@carregando</div>
                </div>
                
                <div class="profile-stats">
                    <div class="profile-stat">
                        <div class="profile-stat-value" id="userPosts">0</div>
                        <div class="profile-stat-label">Posts</div>
                    </div>
                    <div class="profile-stat">
                        <div class="profile-stat-value" id="userComments">0</div>
                        <div class="profile-stat-label">Comments</div>
                    </div>
                    <div class="profile-stat">
                        <div class="profile-stat-value karma-display" id="userKarmaDisplay">0</div>
                        <div class="profile-stat-label">Karma</div>
                    </div>
                </div>
                
                <div class="profile-badges" id="userBadges">
                    <!-- Badges will be added dynamically -->
                </div>
                
                <button class="btn btn-primary" onclick="openCreateModal()" style="width: 100%;">
                    ‚úèÔ∏è Criar Post
                </button>
            </div>

            <!-- Community Card -->
            <div class="community-card">
                <div class="community-header">
                    <div class="community-avatar">‚ö´</div>
                    <div class="community-info">
                        <h3>r/Roxe</h3>
                        <p>Uma comunidade para compartilhar ideias</p>
                    </div>
                </div>
                
                <div class="community-stats">
                    <span>üë• <span id="communityMembers">1</span> membros</span>
                    <span>üìä <span id="communityPosts">0</span> posts</span>
                </div>
                
                <button class="community-action" onclick="joinCommunity()">
                    Juntar-se √† Comunidade
                </button>
            </div>

            <!-- Trending Topics -->
            <div class="community-card">
                <h3>üî• T√≥picos em Alta</h3>
                <div class="trending-list" id="trendingTopics">
                    <div class="trending-item">üí¨ discuss√£o</div>
                    <div class="trending-item">‚ù§Ô∏è ajuda</div>
                    <div class="trending-item">üöÄ tecnologia</div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="reddit-main">
            <!-- Sort and Filter Bar -->
            <div class="content-header">
                <div class="sort-options">
                    <button class="sort-btn active" onclick="sortPosts('hot')">üî• Quente</button>
                    <button class="sort-btn" onclick="sortPosts('new')">‚ú® Novo</button>
                    <button class="sort-btn" onclick="sortPosts('top')">‚¨ÜÔ∏è Top</button>
                    <button class="sort-btn" onclick="sortPosts('rising')">üìà Crescente</button>
                </div>
                
                <div class="view-options">
                    <select id="categoryFilter" onchange="filterPosts()">
                        <option value="">r/Roxe</option>
                        <option value="tecnologia">r/tecnologia</option>
                        <option value="design">r/design</option>
                        <option value="programacao">r/programacao</option>
                        <option value="negocios">r/negocios</option>
                        <option value="pessoal">r/pessoal</option>
                        <option value="jogos">r/jogos</option>
                        <option value="noticias">r/noticias</option>
                        <option value="memes">r/memes</option>
                        <option value="ajuda">r/ajuda</option>
                        <option value="debate">r/debate</option>
                        <option value="offtopic">r/offtopic</option>
                        <option value="arte">r/arte</option>
                        <option value="musica">r/musica</option>
                        <option value="filmes">r/filmes</option>
                        <option value="livros">r/livros</option>
                        <option value="viagens">r/viagens</option>
                    </select>
                </div>
            </div>

            <!-- Posts Feed -->
            <div id="posts" class="reddit-posts-feed">
                <div class="loading-state" id="loadingPosts">
                    <div class="loading-spinner"></div>
                    <p>Carregando posts...</p>
                </div>
                
                <div class="empty-state" id="emptyPosts" style="display: none;">
                    <div class="empty-icon">üìù</div>
                    <h3>Nenhum post encontrado</h3>
                    <p>Seja o primeiro a compartilhar algo com a comunidade!</p>
                    <button class="btn btn-primary" onclick="openCreateModal()">
                        Criar Primeiro Post
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Create Post Modal -->
    <div id="createModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Criar Novo Post</h3>
                <button class="modal-close" onclick="closeCreateModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="quickCreateForm">
                    <div class="form-group">
                        <label for="quickTitle" class="form-label">T√≠tulo</label>
                        <input 
                            type="text" 
                            id="quickTitle" 
                            class="form-input"
                            placeholder="Digite um t√≠tulo interessante..."
                            required
                            maxlength="300"
                        >
                        <div class="char-count">
                            <span id="titleCount">0</span>/300
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="quickContent" class="form-label">Conte√∫do</label>
                        <textarea 
                            id="quickContent" 
                            class="form-textarea"
                            placeholder="Digite o conte√∫do do seu post..."
                            rows="8"
                            required
                            maxlength="5000"
                        ></textarea>
                        <div class="char-count">
                            <span id="contentCount">0</span>/5000
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="quickCategory" class="form-label">Comunidade</label>
                        <select id="quickCategory" class="form-select">
                            <option value="">r/Roxe</option>
                            <option value="tecnologia">r/tecnologia</option>
                            <option value="design">r/design</option>
                            <option value="programacao">r/programacao</option>
                            <option value="negocios">r/negocios</option>
                            <option value="pessoal">r/pessoal</option>
                            <option value="jogos">r/jogos</option>
                            <option value="noticias">r/noticias</option>
                            <option value="memes">r/memes</option>
                            <option value="ajuda">r/ajuda</option>
                            <option value="debate">r/debate</option>
                            <option value="offtopic">r/offtopic</option>
                            <option value="arte">r/arte</option>
                            <option value="musica">r/musica</option>
                            <option value="filmes">r/filmes</option>
                            <option value="livros">r/livros</option>
                            <option value="viagens">r/viagens</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="quickTags" class="form-label">Tags</label>
                        <input 
                            type="text" 
                            id="quickTags" 
                            class="form-input"
                            placeholder="separe tags com v√≠rgulas (ex: javascript, web, tutorial)"
                        >
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="postSpoiler"> Spoiler
                        </label>
                        <label>
                            <input type="checkbox" id="postNSFW"> NSFW
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="quickCreatePost()">
                    Publicar
                </button>
                <button class="btn btn-outline" onclick="closeCreateModal()">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Post Viewer Modal -->
    <div id="viewer" class="modal viewer-modal" style="display: none;">
        <div class="modal-content viewer-content">
            <div class="viewer-header">
                <h2 id="viewTitle" class="viewer-title"></h2>
                <button class="modal-close" onclick="closeViewer()">&times;</button>
            </div>
            <div class="viewer-body">
                <div class="post-meta">
                    <span class="post-category" id="viewCategory"></span>
                    <span class="post-date" id="viewDate"></span>
                </div>
                <div class="post-tags" id="viewTags"></div>
                <div id="viewContent" class="post-content"></div>
            </div>
            <div class="viewer-actions">
                <button class="btn btn-secondary" onclick="editPost()">
                    ‚úèÔ∏è Editar
                </button>
                <button class="btn btn-danger" onclick="deletePost()">
                    üóëÔ∏è Excluir
                </button>
                <button class="btn btn-outline" onclick="closeViewer()">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <!-- Friends Modal -->
    <div id="friendsModal" class="modal" style="display: none;">
        <div class="modal-content friends-modal">
            <div class="modal-header">
                <h3>üë• Amigos</h3>
                <button class="modal-close" onclick="closeFriendsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="friends-container">
                    <div class="friends-section">
                        <h4>Adicionar Amigo</h4>
                        <div class="add-friend-form">
                            <input type="text" id="friendUsername" placeholder="Nome de usu√°rio...">
                            <button onclick="addFriend()">Adicionar</button>
                        </div>
                    </div>
                    
                    <div class="friends-section">
                        <h4>Lista de Amigos</h4>
                        <div class="friends-list" id="friendsList">
                            <!-- Friends will be added here -->
                        </div>
                    </div>
                    
                    <div class="friends-section">
                        <h4>Solicita√ß√µes Pendentes</h4>
                        <div class="friend-requests" id="friendRequests">
                            <!-- Requests will be added here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Modal -->
    <div id="chatModal" class="modal" style="display: none;">
        <div class="modal-content chat-modal">
            <div class="modal-header">
                <h3>üí¨ Bate-Papo</h3>
                <button class="modal-close" onclick="closeChatModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                        <!-- Messages will be added here -->
                    </div>
                    <div class="chat-input">
                        <input type="text" id="chatInput" placeholder="Digite sua mensagem..." onkeypress="if(event.key==='Enter') sendMessage()">
                        <button onclick="sendMessage()">Enviar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast" style="display: none;">
        <div class="toast-content">
            <span id="toastMessage"></span>
            <button class="toast-close" onclick="hideToast()">&times;</button>
        </div>
    </div>

    <!-- Floating Action Button -->
    <button class="fab" onclick="openCreateModal()" title="Criar Novo Post">
        ‚úèÔ∏è
    </button>
    
    <button class="theme-toggle" onclick="toggleTheme()" title="Alternar Tema">
        üåô
    </button>

    <button class="back-to-top" onclick="scrollToTop()" title="Voltar ao topo">‚Üë</button>
    
    <script src="script.js"></script>
<script src="demo.js"></script>
    <script>
        // Inicializa√ß√£o quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Roxe Forum carregando...');
            
            // Carregar tema
            loadTheme();
            updateThemeIcon();
            
            // Carregar posts
            loadPosts();
            updateStats();
            updateProfileDisplay();
            updateCommunityStats();
            
            // Mostrar posts existentes ou estado vazio
            setTimeout(() => {
                const posts = getAllPosts();
                if (posts.length === 0) {
                    document.getElementById('emptyPosts').style.display = 'block';
                    document.getElementById('loadingPosts').style.display = 'none';
                } else {
                    displayPosts(posts);
                }
            }, 500);
            
            console.log('Roxe Forum inicializado!');
        });
        
        // Reddit-style functionality
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('show');
        }

        function toggleUserMenu() {
            const dropdown = document.getElementById('userMenuDropdown');
            dropdown.classList.toggle('show');
        }

        function openProfile() {
            showToast('Perfil em desenvolvimento! üë§', 'info');
            toggleUserMenu();
        }

        function openSettings() {
            showToast('Configura√ß√µes em desenvolvimento! ‚öôÔ∏è', 'info');
            toggleUserMenu();
        }

        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                localStorage.removeItem('rose_forum_user');
                location.reload();
            }
            toggleUserMenu();
        }

        function joinCommunity() {
            showToast('Bem-vindo √† comunidade! üéâ', 'success');
        }

        // Fechar dropdowns ao clicar fora
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.user-menu')) {
                document.getElementById('userMenuDropdown').classList.remove('show');
            }
        });

        // Fun√ß√£o toast para notifica√ß√µes
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            if (toast && toastMessage) {
                toastMessage.textContent = message;
                toast.className = `toast toast-${type}`;
                toast.style.display = 'block';
                
                setTimeout(() => {
                    toast.style.display = 'none';
                }, 3000);
            } else {
                // Fallback se toast n√£o existir
                alert(message);
            }
        }

        function hideToast() {
            const toast = document.getElementById('toast');
            if (toast) {
                toast.style.display = 'none';
            }
        }

        // Fun√ß√µes essenciais que estavam faltando
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            
            const themeToggle = document.querySelector('.theme-toggle');
            if (themeToggle) {
                themeToggle.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            }
        }

        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            const themeToggle = document.querySelector('.theme-toggle');
            if (themeToggle) {
                themeToggle.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            }
            
            showToast(`Tema ${newTheme === 'dark' ? 'escuro' : 'claro'} ativado!`, 'info');
        }

        function updateThemeIcon() {
            const themeToggle = document.querySelector('.theme-toggle');
            const currentTheme = document.body.getAttribute('data-theme') || 'light';
            if (themeToggle) {
                themeToggle.textContent = currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            }
        }

        function updateStats() {
            const posts = getAllPosts();
            const today = new Date().toDateString();
            const todayPosts = posts.filter(post => 
                new Date(post.date).toDateString() === today
            );
            
            // Update stats if elements exist
            const totalPostsElement = document.getElementById('totalPosts');
            if (totalPostsElement) totalPostsElement.textContent = posts.length;
            
            const todayPostsElement = document.getElementById('todayPosts');
            if (todayPostsElement) todayPostsElement.textContent = todayPosts.length;
        }

        function loadPosts() {
            displayPosts();
        }

        function getAllPosts() {
            try {
                const posts = localStorage.getItem('rose_forum_posts');
                return posts ? JSON.parse(posts) : [];
            } catch (error) {
                console.error('Erro ao carregar posts:', error);
                return [];
            }
        }

        function displayPosts(posts = null) {
            const postsToShow = posts || getAllPosts();
            const container = document.getElementById('posts');
            
            if (!container) return;
            
            // Hide loading
            const loadingElement = document.getElementById('loadingPosts');
            if (loadingElement) loadingElement.style.display = 'none';
            
            // Show empty state if no posts
            const emptyElement = document.getElementById('emptyPosts');
            if (emptyElement) {
                emptyElement.style.display = postsToShow.length === 0 ? 'block' : 'none';
            }
            
            if (postsToShow.length === 0) {
                if (container) {
                    container.innerHTML = `
                        <div class="empty-state" id="emptyPosts">
                            <div class="empty-icon">üìù</div>
                            <h3>Nenhum post encontrado</h3>
                            <p>Seja o primeiro a compartilhar algo com a comunidade!</p>
                            <button class="btn btn-primary" onclick="openCreateModal()">
                                Criar Primeiro Post
                            </button>
                        </div>
                    `;
                }
                return;
            }
            
            // Display posts
            if (container) {
                container.innerHTML = postsToShow.map((post, index) => {
                    const score = (post.upvotes || 0) - (post.downvotes || 0);
                    const categoryText = post.category ? `r/${post.category}` : 'r/Roxe';
                    
                    return `
                    <article class="post" data-post-id="${post.id}">
                        <div class="post-header">
                            <div class="subreddit-info">
                                <div class="subreddit-icon">‚ö´</div>
                                <div>
                                    <span class="subreddit-name">${categoryText}</span>
                                    <span class="post-meta-info">
                                        Postado por u/${post.author || 'anonymous'} ‚Ä¢ ${formatDate(post.date)}
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="post-content">
                            <h3 class="post-title" onclick="viewPost('${post.id}')">
                                ${post.title}
                            </h3>
                            
                            ${post.content.length > 200 ? `
                                <div class="post-excerpt">
                                    ${post.content.substring(0, 200)}${post.content.length > 200 ? '...' : ''}
                                </div>
                            ` : `
                                <div class="post-excerpt">
                                    ${post.content}
                                </div>
                            `}
                            
                            ${post.tags.length > 0 ? `
                                <div class="post-tags">
                                    ${post.tags.map(tag => `<span class="tag">#${tag}</span>`).join('')}
                                </div>
                            ` : ''}
                            
                            <div class="post-actions">
                                <button class="btn btn-sm" onclick="viewPost('${post.id}')">
                                    üí¨ Ver Post
                                </button>
                                <button class="btn btn-sm" onclick="sharePost('${post.id}')">
                                    üîó Compartilhar
                                </button>
                            </div>
                        </div>
                    </article>
                `;
                }).join('');
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) {
                const diffHours = Math.floor(diffTime / (1000 * 60 * 60));
                if (diffHours === 0) {
                    const diffMinutes = Math.floor(diffTime / (1000 * 60));
                    return diffMinutes === 0 ? 'Agora' : `${diffMinutes} min atr√°s`;
                }
                return `${diffHours}h atr√°s`;
            } else if (diffDays === 1) {
                return 'Ontem';
            } else if (diffDays < 7) {
                return `${diffDays} dias atr√°s`;
            } else {
                return date.toLocaleDateString('pt-BR');
            }
        }

        function getCurrentUser() {
            const user = localStorage.getItem('rose_forum_user');
            if (user) {
                return JSON.parse(user);
            }
            
            // Create default user
            const defaultUser = {
                name: 'UsuarioDemo',
                avatar: null,
                joinDate: new Date().toISOString()
            };
            
            localStorage.setItem('rose_forum_user', JSON.stringify(defaultUser));
            return defaultUser;
        }

        function updateProfileDisplay() {
            const user = getCurrentUser();
            
            // Update profile info if elements exist
            const profileName = document.getElementById('profileName');
            if (profileName) profileName.textContent = user.name;
            
            const profileUsername = document.getElementById('profileUsername');
            if (profileUsername) profileUsername.textContent = '@' + user.name.toLowerCase().replace(/\s+/g, '');
            
            const userAvatarSmall = document.getElementById('userAvatarSmall');
            if (userAvatarSmall) userAvatarSmall.textContent = user.name.charAt(0).toUpperCase();
            
            const profileAvatar = document.getElementById('profileAvatar');
            if (profileAvatar) profileAvatar.textContent = user.name.charAt(0).toUpperCase();
            
            // Update karma
            const posts = getAllPosts().filter(p => p.author === user.name);
            let totalKarma = 0;
            posts.forEach(post => {
                totalKarma += (post.upvotes || 0) - (post.downvotes || 0);
            });
            
            const userKarma = document.getElementById('userKarma');
            if (userKarma) userKarma.textContent = totalKarma + ' karma';
            
            const userKarmaDisplay = document.getElementById('userKarmaDisplay');
            if (userKarmaDisplay) userKarmaDisplay.textContent = totalKarma;
            
            // Update post count
            const userPosts = document.getElementById('userPosts');
            if (userPosts) userPosts.textContent = posts.length;
        }

        function updateCommunityStats() {
            const posts = getAllPosts();
            const users = new Set(posts.map(p => p.author));
            
            const communityMembers = document.getElementById('communityMembers');
            if (communityMembers) communityMembers.textContent = users.size + 1;
            
            const communityPosts = document.getElementById('communityPosts');
            if (communityPosts) communityPosts.textContent = posts.length;
        }

        function viewPost(postId) {
            showToast('Visualizando post ' + postId, 'info');
        }

        function sharePost(postId) {
            const posts = getAllPosts();
            const post = posts.find(p => p.id === postId);
            
            if (post) {
                const shareUrl = `${window.location.origin}#post-${postId}`;
                
                if (navigator.share) {
                    navigator.share({
                        title: post.title,
                        text: post.content.substring(0, 100) + '...',
                        url: shareUrl
                    });
                } else {
                    navigator.clipboard.writeText(shareUrl);
                    showToast('Link copiado para a √°rea de transfer√™ncia!', 'success');
                }
            }
        }

        // Fun√ß√µes dos Modais
        function openCreateModal() {
            const modal = document.getElementById('createModal');
            if (modal) {
                modal.style.display = 'flex';
                // Clear form
                const quickTitle = document.getElementById('quickTitle');
                const quickContent = document.getElementById('quickContent');
                const quickCategory = document.getElementById('quickCategory');
                const quickTags = document.getElementById('quickTags');
                const titleCount = document.getElementById('titleCount');
                const contentCount = document.getElementById('contentCount');
                
                if (quickTitle) quickTitle.value = '';
                if (quickContent) quickContent.value = '';
                if (quickCategory) quickCategory.value = '';
                if (quickTags) quickTags.value = '';
                if (titleCount) titleCount.textContent = '0';
                if (contentCount) contentCount.textContent = '0';
            }
        }

        function closeCreateModal() {
            const modal = document.getElementById('createModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function quickCreatePost() {
            const title = document.getElementById('quickTitle')?.value.trim();
            const content = document.getElementById('quickContent')?.value.trim();
            const category = document.getElementById('quickCategory')?.value || '';
            const tagsInput = document.getElementById('quickTags')?.value.trim() || '';
            
            if (!title || !content) {
                showToast('Preencha t√≠tulo e conte√∫do', 'error');
                return;
            }
            
            const tags = tagsInput ? tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag) : [];
            
            // Criar post
            const post = {
                id: Date.now().toString(),
                title: title,
                content: content,
                category: category,
                tags: tags,
                date: new Date().toISOString(),
                views: 0,
                likes: 0,
                upvotes: 0,
                downvotes: 0,
                userVote: null,
                author: getCurrentUser().name
            };
            
            // Salvar post
            const posts = getAllPosts();
            posts.unshift(post);
            
            try {
                localStorage.setItem('rose_forum_posts', JSON.stringify(posts));
                showToast('Post criado com sucesso!', 'success');
                closeCreateModal();
                displayPosts();
                updateStats();
                updateProfileDisplay();
                updateCommunityStats();
            } catch (error) {
                showToast('Erro ao criar post', 'error');
            }
        }

        function openChatModal() {
            const modal = document.getElementById('chatModal');
            if (modal) {
                modal.style.display = 'flex';
                loadChatMessages();
                toggleUserMenu();
            }
        }

        function closeChatModal() {
            const modal = document.getElementById('chatModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            const user = getCurrentUser();
            const chatMessage = {
                id: Date.now().toString(),
                author: user.name,
                text: message,
                timestamp: new Date().toISOString(),
                isOwn: true
            };
            
            // Add message to chat
            addChatMessage(chatMessage);
            
            // Save to storage
            saveChatMessage(chatMessage);
            
            // Clear input
            input.value = '';
            
            // Simulate response after delay
            setTimeout(() => {
                simulateChatResponse();
            }, 1000 + Math.random() * 2000);
        }

        function addChatMessage(message) {
            const messagesContainer = document.getElementById('chatMessages');
            if (!messagesContainer) return;
            
            const messageElement = document.createElement('div');
            messageElement.className = `chat-message ${message.isOwn ? 'own' : 'other'}`;
            messageElement.innerHTML = `
                <div class="chat-author">${message.author}</div>
                <div class="chat-text">${message.text}</div>
                <div class="chat-time">${formatDate(message.timestamp)}</div>
            `;
            
            messagesContainer.appendChild(messageElement);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function loadChatMessages() {
            const messages = getChatMessages();
            const messagesContainer = document.getElementById('chatMessages');
            if (!messagesContainer) return;
            
            messagesContainer.innerHTML = '';
            
            // Add welcome message if no messages
            if (messages.length === 0) {
                addChatMessage({
                    id: Date.now().toString(),
                    author: 'Sistema',
                    text: 'Bem-vindo ao bate-papo do Roxe! Envie uma mensagem para come√ßar.',
                    timestamp: new Date().toISOString(),
                    isOwn: false
                });
            } else {
                messages.forEach(message => addChatMessage(message));
            }
        }

        function getChatMessages() {
            try {
                const messages = localStorage.getItem('rox_chat_messages');
                return messages ? JSON.parse(messages) : [];
            } catch (error) {
                console.error('Erro ao carregar mensagens:', error);
                return [];
            }
        }

        function saveChatMessage(message) {
            try {
                const messages = getChatMessages();
                messages.push(message);
                
                // Keep only last 50 messages
                if (messages.length > 50) {
                    messages.splice(0, messages.length - 50);
                }
                
                localStorage.setItem('rox_chat_messages', JSON.stringify(messages));
                return true;
            } catch (error) {
                console.error('Erro ao salvar mensagem:', error);
                return false;
            }
        }

        function simulateChatResponse() {
            const responses = [
                'Interessante! Conte mais sobre isso.',
                'Eu concordo com voc√™.',
                'Isso me faz pensar...',
                'Boa observa√ß√£o!',
                'Voc√™ tem um ponto v√°lido.',
                'Hmm, nunca pensei por esse √¢ngulo.',
                'Legal! üòä',
                'Com certeza!',
                'Faz sentido.',
                'Eu gostaria de saber mais.'
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            const botMessage = {
                id: Date.now().toString(),
                author: 'BotRoxe',
                text: randomResponse,
                timestamp: new Date().toISOString(),
                isOwn: false
            };
            
            addChatMessage(botMessage);
            saveChatMessage(botMessage);
        }

        function openFriendsModal() {
            const modal = document.getElementById('friendsModal');
            if (modal) {
                modal.style.display = 'flex';
                loadFriends();
                loadFriendRequests();
                toggleUserMenu();
            }
        }

        function closeFriendsModal() {
            const modal = document.getElementById('friendsModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function addFriend() {
            const usernameInput = document.getElementById('friendUsername');
            const username = usernameInput.value.trim();
            
            if (!username) {
                showToast('Digite um nome de usu√°rio', 'error');
                return;
            }
            
            if (username === getCurrentUser().name) {
                showToast('Voc√™ n√£o pode adicionar a si mesmo', 'error');
                return;
            }
            
            const friends = getFriends();
            if (friends.some(f => f.username === username)) {
                showToast('Este usu√°rio j√° √© seu amigo', 'error');
                return;
            }
            
            // Create friend request (simulated)
            const request = {
                id: Date.now().toString(),
                from: getCurrentUser().name,
                to: username,
                timestamp: new Date().toISOString(),
                status: 'pending'
            };
            
            saveFriendRequest(request);
            showToast('Solicita√ß√£o de amizade enviada!', 'success');
            usernameInput.value = '';
            
            // Simulate acceptance for demo
            setTimeout(() => {
                acceptFriendRequest(request.id);
            }, 2000 + Math.random() * 3000);
        }

        function getFriends() {
            try {
                const friends = localStorage.getItem('rox_friends');
                return friends ? JSON.parse(friends) : [];
            } catch (error) {
                console.error('Erro ao carregar amigos:', error);
                return [];
            }
        }

        function saveFriend(friend) {
            try {
                const friends = getFriends();
                friends.push(friend);
                localStorage.setItem('rox_friends', JSON.stringify(friends));
                return true;
            } catch (error) {
                console.error('Erro ao salvar amigo:', error);
                return false;
            }
        }

        function getFriendRequests() {
            try {
                const requests = localStorage.getItem('rox_friend_requests');
                return requests ? JSON.parse(requests) : [];
            } catch (error) {
                console.error('Erro ao carregar solicita√ß√µes:', error);
                return [];
            }
        }

        function saveFriendRequest(request) {
            try {
                const requests = getFriendRequests();
                requests.push(request);
                localStorage.setItem('rox_friend_requests', JSON.stringify(requests));
                return true;
            } catch (error) {
                console.error('Erro ao salvar solicita√ß√£o:', error);
                return false;
            }
        }

        function acceptFriendRequest(requestId) {
            const requests = getFriendRequests();
            const requestIndex = requests.findIndex(r => r.id === requestId);
            
            if (requestIndex === -1) return;
            
            const request = requests[requestIndex];
            
            // Add to friends list
            const friend = {
                id: Date.now().toString(),
                username: request.from === getCurrentUser().name ? request.to : request.from,
                addedAt: new Date().toISOString(),
                status: 'online'
            };
            
            saveFriend(friend);
            
            // Remove request
            requests.splice(requestIndex, 1);
            localStorage.setItem('rox_friend_requests', JSON.stringify(requests));
            
            loadFriends();
            loadFriendRequests();
            showToast(`${friend.username} agora √© seu amigo!`, 'success');
        }

        function loadFriends() {
            const friends = getFriends();
            const friendsList = document.getElementById('friendsList');
            
            if (!friendsList) return;
            
            if (friends.length === 0) {
                friendsList.innerHTML = '<div class="empty-friends">Voc√™ ainda n√£o tem amigos</div>';
                return;
            }
            
            friendsList.innerHTML = friends.map(friend => `
                <div class="friend-item">
                    <div class="friend-info">
                        <div class="friend-avatar">${friend.username.charAt(0).toUpperCase()}</div>
                        <div>
                            <div class="friend-name">${friend.username}</div>
                            <div class="friend-status">${friend.status}</div>
                        </div>
                    </div>
                    <div class="friend-actions">
                        <button onclick="removeFriend('${friend.id}')">Remover</button>
                    </div>
                </div>
            `).join('');
        }

        function loadFriendRequests() {
            const requests = getFriendRequests();
            const requestsContainer = document.getElementById('friendRequests');
            const currentUser = getCurrentUser();
            
            if (!requestsContainer) return;
            
            // Get requests for current user
            const userRequests = requests.filter(r => r.to === currentUser.name && r.status === 'pending');
            
            if (userRequests.length === 0) {
                requestsContainer.innerHTML = '<div class="empty-friends">Nenhuma solicita√ß√£o pendente</div>';
                return;
            }
            
            requestsContainer.innerHTML = userRequests.map(request => `
                <div class="friend-item">
                    <div class="friend-info">
                        <div class="friend-avatar">${request.from.charAt(0).toUpperCase()}</div>
                        <div>
                            <div class="friend-name">${request.from}</div>
                            <div class="friend-status">Solicitou amizade</div>
                        </div>
                    </div>
                    <div class="friend-actions">
                        <button class="accept" onclick="acceptFriendRequest('${request.id}')">Aceitar</button>
                        <button class="deny" onclick="denyFriendRequest('${request.id}')">Recusar</button>
                    </div>
                </div>
            `).join('');
        }

        function removeFriend(friendId) {
            const friends = getFriends();
            const filteredFriends = friends.filter(f => f.id !== friendId);
            
            localStorage.setItem('rox_friends', JSON.stringify(filteredFriends));
            loadFriends();
            showToast('Amigo removido', 'info');
        }

        function denyFriendRequest(requestId) {
            const requests = getFriendRequests();
            const filteredRequests = requests.filter(r => r.id !== requestId);
            
            localStorage.setItem('rox_friend_requests', JSON.stringify(filteredRequests));
            loadFriendRequests();
            showToast('Solicita√ß√£o recusada', 'info');
        }
    </script>
</body>
</html>
